**文件最大打开数(文件描述符)**
linux系统，每个进程打开一个文件时，系统就会为其分配一个唯一的整型文件描述符，用来标识这个文件
linux对文件描述符的限制有两个级别
##### 系统级别：
查看系统总限制
`cat /proc/sys/fs/file-max`，默认值为内存大小(KB)的10%
###### 1）临时修改
```
  echo 65535 > /proc/sys/fs/file-max
```
###### 2）永久生效
在`/etc/sysctl.con`f文件中添加
```
  fs.file-max=65535
```
执行`sysctl -p` 生效
##### 用户级别：
查看当前用户最大文件打开数,`ulimit -n`默认是1024
###### 1）临时生效，关闭当前终端失效
```
  ulimit -SHn 1024
```
`-H`硬限制 `-S`软限制 都不加或者都加两个参数一起改变
硬限制就是实际的限制，软限制是warnning限制，到达最大打开数后，提示warning
###### 2）永久生效，对当前打开的shell和以前打开的shell不生效，只对之后打开的shell生效
配置文件有`/etc/security/limits.conf`和/`etc/security/limits.d/xx.conf`，`/etc/security/limits.d/`目录下的配置会覆盖`/etc/security/limits.conf`的配置
```
  /etc/security/limits.conf
  * soft nofile 65535	*表示所有用户 soft软限制 hard硬限制
  * hard nofile 65535
  test soft nofile 1024
  test hard nofile 1024
  ceshi - nofile 1024   - 表示soft和hard一起修改
```
* 第一列：用户或用户组(@开头)	
* 第二列：软限制/硬限制	
* 第三列：限制资源类型   （core:内核文件，nofile:文件描述符，noproc:进程）
* 第四列：最大值

查看系统当前打开的文件描述符数量
```
  cat /proc/sys/fs/file-nr 
  10336	0	6561159
```
* 第一列：已使用的文件描述符
* 第二列：分配后未使用的
* 第三列：最大文件描述符=/proc/sys/fs/file-max
  
查看某个进程打开的文件描述符数量
```
  lsof -p 22273 | wc -l
  44
```
查看哪些进程占用的文件描述符比较多
```
  [root@node1 ~]# lsof -n | awk '{print $10}' | sort | uniq -c | sort -nr | head -10
    20227 
    17023 pipe
    15458 /home/kylin-ksvd/.ksvd/provtab
    10902 socket
    5824 [eventpoll]
    5282 /dev/null
    5086 [eventfd]
    4607 (path
    3330 /dev/urandom
    3265 /dev/random
```
第一列不是进程号，是打开的文件描述符数量

****

**用户创建最大进程数**
##### 系统级别：
查看系统总限制
`cat /proc/sys/kernel/pid_max`
###### 1）临时修改
```
  echo 65535 > /proc/sys/kernel/pid_max
```
###### 2）永久生效
在`/etc/sysctl.conf`文件中添加
```
  kernel.pid_max=65535
```
执行`sysctl -p` 生效
##### 用户级别：
查看当前用户创建最大进程数
  `ulimit -u`
  `ulimit -a` 查看`max user process`行
###### 1）临时生效，，关闭当前终端失效
```
  ulimit -u 10240
```
###### 2）永久生效，对当前打开的shell和以前打开的shell不生效，只对之后打开的shell生效
配置文件有`/etc/security/limits.conf`和`/etc/security/limits.d/xx.conf`，`/etc/security/limits.d/`目录下的配置会覆盖`/etc/security/limits.conf`的配置
```
  /etc/security/limits.conf
  * soft nproc 65535
  * hard nproc 65535
  test soft nproc 65535
  test hard nproc 65535
```
注意：`20-nproc.conf`文件优先级高于`limits.conf`文件，root用户该文件设置必须将`soft`和`hard`都设置才会对之后打开的shell生效，普通用户只设置一个soft不会生效，设置一个hard生效？？？？（两个都设置任何用户都生效，建议两个都设置）
```
  /etc/security/limits.d/20-nproc.conf
  *          soft    nproc     4096
  *          hard    nproc     4096
  root       soft    nproc     unlimited
  root       hard    nproc     unlimited
```